generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(cuid())
  name        String
  email       String    @unique
  password    String
  role        Role      @default(waiter)
  phone       String?
  joinDate    DateTime  @default(now())
  hourlyRate  Float     @default(0)
  isActive    Boolean   @default(true)
  pin         String?   // 4-digit PIN
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  orders      Order[]
  attendance  Attendance[]
  shifts      Shift[]
}

enum Role {
  admin
  manager
  waiter
  chef
  cashier
}

model Category {
  id          String    @id @default(cuid())
  name        String
  description String?
  image       String?
  order       Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  menuItems   MenuItem[]
}

model MenuItem {
  id              String    @id @default(cuid())
  name            String
  description     String?
  price           Float
  categoryId      String
  category        Category  @relation(fields: [categoryId], references: [id])
  isVeg           Boolean   @default(true)
  image           String?
  isAvailable     Boolean   @default(true)
  preparationTime Int       @default(15) // in minutes
  variants        Json?
  allergens       Json?  // Stored as JSON array: ["peanuts", "dairy"]
  nutritionalInfo Json?
  costPrice       Float     @default(0)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  orderItems      OrderItem[]
}

model Order {
  id              String      @id @default(cuid())
  orderNumber     String      @unique
  orderType       OrderType   @default(dine_in)
  tableNumber     Int?
  subtotal        Float
  tax             Float       @default(0)
  discount        Float       @default(0)
  tip             Float       @default(0)
  total           Float
  status          OrderStatus @default(pending)
  paymentStatus   PaymentStatus @default(unpaid)
  paymentMethod   String?     // cash, card, etc.
  
  billingDetails  Json?
  
  customerName    String?
  customerPhone   String?
  customerEmail   String?
  customerGstin   String?

  createdById     String?
  createdBy       User?       @relation(fields: [createdById], references: [id])
  
  items           OrderItem[]
  transactions    Transaction[]

  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

enum OrderType {
  dine_in
  takeaway
  delivery
}

enum OrderStatus {
  pending
  confirmed
  preparing
  ready
  served
  completed
  cancelled
}

enum PaymentStatus {
  unpaid
  partially_paid
  paid
  refunded
}

model OrderItem {
  id                  String    @id @default(cuid())
  orderId             String
  order               Order     @relation(fields: [orderId], references: [id])
  menuItemId          String
  menuItem            MenuItem  @relation(fields: [menuItemId], references: [id])
  name                String    
  price               Float     
  quantity            Int
  variant             String?
  specialInstructions String?
  status              String?   
}

model Transaction {
  id            String    @id @default(cuid())
  orderId       String
  order         Order     @relation(fields: [orderId], references: [id])
  amount        Float
  paymentMethod String
  transactionId String?
  status        String    @default("success")
  timestamp     DateTime  @default(now())
  note          String?
}

model Table {
  id        String   @id @default(cuid())
  number    Int      @unique
  capacity  Int      @default(4)
  status    String   @default("available") 
  section   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  reservations Reservation[]
}

model Settings {
  id        String   @id @default(cuid()) 
  restaurantName    String?
  restaurantAddress String?
  restaurantPhone   String?
  currency          String        @default("INR")
  currencySymbol    String        @default("â‚¹")
  data              Json
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
}

model Attendance {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  date        DateTime
  clockIn     DateTime
  clockOut    DateTime?
  totalHours  Float?
  status      String    @default("present") 
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Shift {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  startTime DateTime
  endTime   DateTime
  notes     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Reservation {
  id            String   @id @default(cuid())
  customerName  String
  customerPhone String
  tableId       String?
  table         Table?   @relation(fields: [tableId], references: [id])
  dateTime      DateTime
  guests        Int
  status        String   @default("confirmed") 
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

